<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cron√≥metro Bloque Final</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    :root {
      --primary-dark: #0c2461;
      --primary-light: #1e3799;
      --accent-green: #00C853;
      --accent-green-dark: #4CAF50;
      --accent-blue: #2196F3;
      --accent-blue-dark: #1976D2;
      --accent-red: #ff4444;
      --accent-red-dark: #d32f2f;
      --accent-orange: #FF9800;
      --accent-yellow: #ffcc00;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
      color: white;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      text-align: center;
    }

    .container {
      width: 100%;
      max-width: 900px;
    }

    h1 {
      font-size: 3.5rem;
      color: var(--accent-yellow);
      text-shadow: 0 0 25px rgba(255, 204, 0, 0.5);
      letter-spacing: 1px;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .phase-indicator {
      font-size: 2.2rem;
      font-weight: 700;
      margin: 1.5rem auto;
      padding: 1rem;
      border-radius: 15px;
      background: rgba(255, 255, 255, 0.1);
      width: fit-content;
      min-width: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      transition: all 0.3s;
    }

    .bloque-activo {
      background: rgba(0, 100, 0, 0.25);
      border: 2px solid var(--accent-green);
      color: #c8e6c9;
    }

    .transicion-activa {
      background: rgba(255, 152, 0, 0.25);
      border: 2px solid var(--accent-orange);
      color: #ffe0b2;
    }

    .timer-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 2rem 0;
      position: relative;
    }

    #timer {
      font-size: 11rem;
      font-weight: 900;
      text-shadow: 0 0 40px rgba(255, 255, 255, 0.9);
      font-variant-numeric: tabular-nums;
      letter-spacing: 10px;
      line-height: 1;
      transition: all 0.3s;
      display: inline-block;
      text-align: center;
      min-width: 500px;
    }

    .tiempo-critico {
      color: var(--accent-red) !important;
      animation: pulse 0.8s infinite alternate;
      text-shadow: 0 0 50px rgba(255, 68, 68, 0.8) !important;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(1.03); opacity: 0.9; }
    }

    .progress-container {
      width: 80%;
      max-width: 600px;
      height: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      overflow: hidden;
      margin: 1rem auto;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
      width: 0%;
      transition: width 1s linear;
      border-radius: 5px;
    }

    .controls {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin: 2.5rem 0;
      flex-wrap: wrap;
    }

    .btn {
      padding: 1.4rem 2.8rem;
      font-size: 1.3rem;
      font-weight: 700;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 200px;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .btn-start {
      background: linear-gradient(135deg, var(--accent-green), var(--accent-green-dark));
      color: white;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .btn-start:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 200, 83, 0.3);
    }

    .btn-stop {
      background: linear-gradient(135deg, var(--accent-red), var(--accent-red-dark));
      color: white;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .btn-stop:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(255, 68, 68, 0.3);
    }

    .btn-reset {
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-blue-dark));
      color: white;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .btn-reset:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(33, 150, 243, 0.3);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2) !important;
    }

    /* Indicador de conexi√≥n */
    .conexion-indicator {
      position: fixed;
      top: 15px;
      right: 15px;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      z-index: 1000;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
    }
    .conexion-activa { 
      background: var(--accent-green); 
      color: white;
    }
    .conexion-inactiva { 
      background: var(--accent-red); 
      color: white;
    }

    /* Aviso de audio */
    .aviso-audio {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 600;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      animation: pulse-aviso 2s infinite alternate;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    @keyframes pulse-aviso {
      0% { 
        transform: translateX(-50%) scale(1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }
      100% { 
        transform: translateX(-50%) scale(1.05);
        box-shadow: 0 6px 20px rgba(255, 204, 0, 0.4);
      }
    }

    .aviso-audio i {
      color: var(--accent-yellow);
      font-size: 1.2rem;
    }

    .aviso-audio.audio-activado {
      background: rgba(0, 200, 83, 0.8);
      animation: pulse-verde 2s infinite alternate;
    }

    @keyframes pulse-verde {
      0% { 
        transform: translateX(-50%) scale(1);
        box-shadow: 0 4px 15px rgba(0, 200, 83, 0.3);
      }
      100% { 
        transform: translateX(-50%) scale(1.05);
        box-shadow: 0 6px 20px rgba(0, 200, 83, 0.6);
      }
    }

    /* Responsive */
    @media (max-width: 992px) {
      h1 { font-size: 2.8rem; }
      #timer { font-size: 9rem; letter-spacing: 8px; min-width: 400px; }
      .phase-indicator { font-size: 2rem; min-width: 350px; }
      .btn { min-width: 180px; padding: 1.2rem 2.4rem; }
    }

    @media (max-width: 768px) {
      h1 { font-size: 2.4rem; }
      #timer { font-size: 7rem; letter-spacing: 6px; min-width: 300px; }
      .phase-indicator { font-size: 1.7rem; min-width: 300px; padding: 0.8rem; }
      .btn { min-width: 160px; padding: 1.1rem 2.2rem; font-size: 1.2rem; }
      .controls { gap: 15px; }
      .conexion-indicator {
        top: 10px;
        right: 10px;
        font-size: 0.8rem;
        padding: 6px 12px;
      }
      .aviso-audio {
        font-size: 0.9rem;
        padding: 10px 16px;
        bottom: 15px;
      }
    }

    @media (max-width: 480px) {
      h1 { font-size: 2rem; flex-direction: column; gap: 10px; }
      #timer { font-size: 5.5rem; letter-spacing: 4px; min-width: 250px; }
      .phase-indicator { font-size: 1.5rem; min-width: 250px; padding: 0.8rem; }
      .btn { min-width: 100%; padding: 1rem 1.8rem; font-size: 1.1rem; }
      .controls { flex-direction: column; }
      .aviso-audio {
        font-size: 0.8rem;
        padding: 8px 14px;
        bottom: 10px;
        width: 90%;
        text-align: center;
      }
    }
  </style>
</head>
<body>

<!-- Indicador de conexi√≥n -->
<div id="conexionIndicator" class="conexion-indicator conexion-activa">
  <i class="fas fa-wifi"></i> CONECTADO
</div>

<!-- Aviso de audio -->
<div id="avisoAudio" class="aviso-audio">
  <i class="fas fa-volume-up"></i>
  <span>Toque la pantalla para activar el sonido</span>
</div>

<div class="container">
  <h1><i class="fas fa-hourglass-half"></i> CRON√ìMETRO BLOQUE FINAL</h1>

  <div id="phaseIndicator" class="phase-indicator bloque-activo">
    <i class="fas fa-clock"></i> BLOQUE DE 4 MINUTOS
  </div>

  <div class="progress-container">
    <div id="progressBar" class="progress-bar"></div>
  </div>

  <div class="timer-container">
    <div id="timer">04:00</div>
  </div>

  <div class="controls">
    <button id="startBtn" class="btn btn-start">
      <i class="fas fa-play"></i> <span>INICIAR</span>
    </button>
    <button id="stopBtn" class="btn btn-stop">
      <i class="fas fa-pause"></i> <span>DETENER</span>
    </button>
    <button id="resetBtn" class="btn btn-reset">
      <i class="fas fa-redo"></i> <span>REINICIAR</span>
    </button>
  </div>
</div>

<script>
// ================= üî• CONFIGURACI√ìN FIREBASE =================
const firebaseConfig = {
  apiKey: "AIzaSyBnTSJbgvcdQ42n74Nl_ZfMJcfgq558Ca0",
  authDomain: "cronometro-sincronizado.firebaseapp.com",
  databaseURL: "https://cronometro-sincronizado-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cronometro-sincronizado",
  storageBucket: "cronometro-sincronizado.firebasestorage.app",
  messagingSenderId: "672715534894",
  appId: "1:672715534894:web:cd3b64f3676aa9a95b65bf"
};

// Inicializar Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= ‚è± CONFIGURACI√ìN =================
const TIEMPO_BLOQUE = 4 * 60;      // 4 minutos
const TIEMPO_TRANSICION = 15;      // 15 segundos
let intervalo = null;
let enFaseBloque = true;
let tiempoRestante = TIEMPO_BLOQUE;
let tiempoTotalFase = TIEMPO_BLOQUE;

// Audio
let audioContext = null;
let sonidosHabilitados = false;

// ================= üéµ SISTEMA DE ALARMAS =================
function inicializarAudio() {
  try {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    sonidosHabilitados = true;
    console.log("‚úÖ Audio habilitado");
    
    // Cambiar el aviso de audio para indicar que est√° activado
    const avisoAudio = document.getElementById('avisoAudio');
    const icono = avisoAudio.querySelector('i');
    const texto = avisoAudio.querySelector('span');
    
    avisoAudio.classList.add('audio-activado');
    icono.className = 'fas fa-volume-up';
    texto.textContent = 'Sonido activado ‚úì';
    
    // Despu√©s de 3 segundos, volver al mensaje original pero mantener el estilo
    setTimeout(() => {
      texto.textContent = 'Sonido activado - Toque para probar';
    }, 3000);
    
    // Remover los listeners de activaci√≥n de audio
    document.removeEventListener('click', manejarActivacionAudio);
    document.removeEventListener('touchstart', manejarActivacionAudio);
    
  } catch (e) {
    console.error("‚ùå Audio no disponible:", e);
    sonidosHabilitados = false;
    
    // Si no se puede activar el audio, cambiar el mensaje
    const avisoAudio = document.getElementById('avisoAudio');
    const icono = avisoAudio.querySelector('i');
    const texto = avisoAudio.querySelector('span');
    
    avisoAudio.style.background = 'rgba(255, 68, 68, 0.8)';
    icono.className = 'fas fa-volume-mute';
    texto.textContent = 'Audio no disponible';
    
    // Remover los listeners de activaci√≥n de audio
    document.removeEventListener('click', manejarActivacionAudio);
    document.removeEventListener('touchstart', manejarActivacionAudio);
  }
}

function reproducirAlarmaLarga() {
  if (!sonidosHabilitados) return;
  try {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    oscillator.frequency.value = 550;
    oscillator.type = 'sawtooth';
    const ahora = audioContext.currentTime;
    gainNode.gain.setValueAtTime(0, ahora);
    gainNode.gain.linearRampToValueAtTime(1.0, ahora + 0.01);
    gainNode.gain.setValueAtTime(1.0, ahora + 1.8);
    gainNode.gain.exponentialRampToValueAtTime(0.001, ahora + 2.2);
    oscillator.start(ahora);
    oscillator.stop(ahora + 2.2);
  } catch (e) { console.log("Alarma"); }
}

function reproducirPitidoCorto() {
  if (!sonidosHabilitados) return;
  try {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    oscillator.frequency.value = 1200;
    oscillator.type = 'sine';
    const ahora = audioContext.currentTime;
    gainNode.gain.setValueAtTime(0, ahora);
    gainNode.gain.linearRampToValueAtTime(1.0, ahora + 0.005);
    gainNode.gain.exponentialRampToValueAtTime(0.001, ahora + 0.18);
    oscillator.start(ahora);
    oscillator.stop(ahora + 0.18);
  } catch (e) { console.log("Pitido"); }
}

function reproducirPitidoFinal() {
  if (!sonidosHabilitados) return;
  try {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    oscillator.frequency.value = 1400;
    oscillator.type = 'square';
    const ahora = audioContext.currentTime;
    gainNode.gain.setValueAtTime(0, ahora);
    gainNode.gain.linearRampToValueAtTime(1.0, ahora + 0.01);
    gainNode.gain.setValueAtTime(1.0, ahora + 0.6);
    gainNode.gain.exponentialRampToValueAtTime(0.001, ahora + 0.8);
    oscillator.start(ahora);
    oscillator.stop(ahora + 0.8);
  } catch (e) { console.log("Pitido final"); }
}

// ================= üì° SINCRONIZACI√ìN =================
// Estado inicial en Firebase si no existe
db.ref("cronometro").once("value").then(snapshot => {
  if (!snapshot.exists()) {
    db.ref("cronometro").set({
      enEjecucion: false,
      fase: 'bloque',
      inicio: null,
      tiempoTranscurrido: null
    });
  }
});

db.ref("cronometro").on("value", snapshot => {
  const data = snapshot.val();
  
  // Determinar fase actual
  if (data) {
    enFaseBloque = data.fase === 'bloque';
  } else {
    enFaseBloque = true;
  }
  
  tiempoTotalFase = enFaseBloque ? TIEMPO_BLOQUE : TIEMPO_TRANSICION;

  if (!data || !data.enEjecucion) {
    // Cron√≥metro DETENIDO o PAUSADO
    clearInterval(intervalo);
    
    if (!data || data.tiempoTranscurrido === null) {
      // Estado inicial - completamente detenido (mostrar 04:00)
      tiempoRestante = TIEMPO_BLOQUE;
      actualizarBotones(true, false, false, true); // INICIAR y REINICIAR habilitados
    } else if (data.tiempoTranscurrido !== null && data.tiempoTranscurrido !== undefined) {
      // Est√° PAUSADO - mostrar tiempo donde se paus√≥
      tiempoRestante = Math.max(tiempoTotalFase - data.tiempoTranscurrido, 0);
      actualizarBotones(true, true, false, true); // INICIAR, REANUDAR y REINICIAR habilitados
    } else {
      // Detenido pero no pausado
      tiempoRestante = tiempoTotalFase;
      actualizarBotones(true, false, false, true); // INICIAR y REINICIAR habilitados
    }
    
    actualizarDisplay();
    actualizarFase();
  } else {
    // Cron√≥metro CORRIENDO
    const ahora = Date.now();
    const tiempoTranscurrido = Math.floor((ahora - data.inicio) / 1000);
    tiempoRestante = Math.max(tiempoTotalFase - tiempoTranscurrido, 0);

    // Actualizar interfaz
    actualizarDisplay();
    actualizarFase();
    actualizarBotones(false, true, true, true); // DETENER y REINICIAR habilitados
    
    // Limpiar intervalo anterior
    clearInterval(intervalo);
    
    // Crear nuevo intervalo sincronizado
    intervalo = setInterval(() => {
      tiempoRestante = Math.max(tiempoRestante - 1, 0);
      actualizarDisplay();
      manejarAlarmasLocales();

      // Verificar cambio de fase
      if (tiempoRestante === 0) {
        clearInterval(intervalo);
        // Cambiar fase en Firebase
        cambiarFaseEnFirebase(data);
      }
    }, 1000);
  }
});

function cambiarFaseEnFirebase(dataActual) {
  db.ref("cronometro").once("value").then(snapshot => {
    const data = snapshot.val();
    if (!data || !data.enEjecucion) return;
    
    // Cambiar a la siguiente fase
    const nuevaFase = data.fase === 'bloque' ? 'transicion' : 'bloque';
    db.ref("cronometro").set({
      enEjecucion: true,
      fase: nuevaFase,
      inicio: Date.now(),
      tiempoTranscurrido: null
    });
  });
}

// ================= üéÆ CONTROLES =================
function iniciar() {
  // INICIAR siempre comienza desde 4:00
  db.ref("cronometro").set({
    enEjecucion: true,
    fase: 'bloque',
    inicio: Date.now(),
    tiempoTranscurrido: null
  });
}

function detener() {
  // Obtener estado actual
  db.ref("cronometro").once("value").then(snapshot => {
    const data = snapshot.val();
    if (!data) return;
    
    if (data.enEjecucion) {
      // Si est√° corriendo, PAUSAR
      const ahora = Date.now();
      const tiempoTranscurrido = Math.floor((ahora - data.inicio) / 1000);
      
      db.ref("cronometro").update({
        enEjecucion: false,
        tiempoTranscurrido: tiempoTranscurrido
      });
    } else {
      // Si est√° pausado, REANUDAR desde donde se paus√≥
      const tiempoTranscurrido = data.tiempoTranscurrido || 0;
      const nuevoInicio = Date.now() - (tiempoTranscurrido * 1000);
      
      db.ref("cronometro").set({
        enEjecucion: true,
        fase: data.fase || 'bloque',
        inicio: nuevoInicio,
        tiempoTranscurrido: null
      });
    }
  });
}

function reiniciar() {
  // REINICIAR - vuelve a 4:00 y empieza autom√°ticamente
  db.ref("cronometro").set({
    enEjecucion: true,
    fase: 'bloque',
    inicio: Date.now(),
    tiempoTranscurrido: null
  });
}

// ================= üñ• INTERFAZ =================
function actualizarDisplay() {
  const minutos = Math.floor(tiempoRestante / 60);
  const segundos = tiempoRestante % 60;
  const timer = document.getElementById('timer');
  timer.textContent = `${String(minutos).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`;
  
  // Barra de progreso
  const progreso = ((tiempoTotalFase - tiempoRestante) / tiempoTotalFase) * 100;
  document.getElementById('progressBar').style.width = `${progreso}%`;
  
  // Color cr√≠tico
  if (tiempoRestante <= 10) {
    timer.classList.add('tiempo-critico');
    document.getElementById('progressBar').style.background = 'linear-gradient(90deg, var(--accent-orange), var(--accent-red))';
  } else {
    timer.classList.remove('tiempo-critico');
    document.getElementById('progressBar').style.background = enFaseBloque 
      ? 'linear-gradient(90deg, var(--accent-green), var(--accent-blue))' 
      : 'linear-gradient(90deg, var(--accent-orange), var(--accent-yellow))';
  }
}

function actualizarFase() {
  const phaseIndicator = document.getElementById('phaseIndicator');
  if (enFaseBloque) {
    phaseIndicator.innerHTML = '<i class="fas fa-clock"></i> BLOQUE DE 4 MINUTOS';
    phaseIndicator.className = 'phase-indicator bloque-activo';
  } else {
    phaseIndicator.innerHTML = '<i class="fas fa-exchange-alt"></i> TRANSICI√ìN DE 15 SEGUNDOS';
    phaseIndicator.className = 'phase-indicator transicion-activa';
  }
}

function actualizarBotones(iniciarHabilitado, detenerHabilitado, esPausa, reiniciarHabilitado) {
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const resetBtn = document.getElementById('resetBtn');
  
  // Bot√≥n INICIAR - SIEMPRE habilitado cuando el cron√≥metro NO est√° corriendo
  startBtn.disabled = !iniciarHabilitado;
  
  // Bot√≥n DETENER/REANUDAR
  stopBtn.disabled = !detenerHabilitado;
  const stopIcon = stopBtn.querySelector('i');
  const stopText = stopBtn.querySelector('span');
  
  if (esPausa) {
    // Mostrar como DETENER (porque est√° corriendo)
    stopIcon.className = 'fas fa-pause';
    stopText.textContent = 'DETENER';
  } else if (detenerHabilitado) {
    // Mostrar como REANUDAR (porque est√° pausado)
    stopIcon.className = 'fas fa-play';
    stopText.textContent = 'REANUDAR';
  } else {
    // Mostrar como DETENER (estado inicial)
    stopIcon.className = 'fas fa-pause';
    stopText.textContent = 'DETENER';
  }
  
  // Bot√≥n REINICIAR - siempre habilitado
  resetBtn.disabled = !reiniciarHabilitado;
}

function manejarAlarmasLocales() {
  // Alarma de 1 minuto (solo en bloque)
  if (enFaseBloque && tiempoRestante === 60) {
    console.log("‚ö†Ô∏è Alarma: 1 minuto restante");
    reproducirAlarmaLarga();
  }
  
  // √öltimos 5 segundos
  if (tiempoRestante <= 5 && tiempoRestante > 0) {
    console.log(`‚è±Ô∏è ${tiempoRestante}...`);
    if (tiempoRestante === 1) {
      reproducirPitidoFinal(); // √öltimo pitido m√°s largo
    } else {
      reproducirPitidoCorto();
    }
  }
}

// ================= üì∂ MONITOREO DE CONEXI√ìN =================
db.ref(".info/connected").on("value", snapshot => {
  const conectado = snapshot.val();
  const indicator = document.getElementById('conexionIndicator');
  
  if (conectado) {
    indicator.innerHTML = '<i class="fas fa-wifi"></i> CONECTADO';
    indicator.className = 'conexion-indicator conexion-activa';
  } else {
    indicator.innerHTML = '<i class="fas fa-wifi-slash"></i> SIN CONEXI√ìN';
    indicator.className = 'conexion-indicator conexion-inactiva';
  }
});

// ================= üîä ACTIVACI√ìN DE AUDIO =================
function manejarActivacionAudio(event) {
  // Solo activar audio si NO se hace clic en un bot√≥n
  if (!event.target.closest('.btn')) {
    if (!sonidosHabilitados) {
      inicializarAudio();
      // Reproducir un sonido de prueba
      if (audioContext) {
        setTimeout(() => {
          if (sonidosHabilitados) {
            reproducirPitidoCorto();
          }
        }, 100);
      }
    }
  }
}

// Agregar listeners para activar audio SOLO en √°reas que no sean botones
document.addEventListener('click', manejarActivacionAudio);
document.addEventListener('touchstart', manejarActivacionAudio);

// ================= üöÄ INICIALIZACI√ìN =================
// Configurar event listeners para los botones
document.getElementById('startBtn').addEventListener('click', function(event) {
  event.stopPropagation(); // Evitar que el evento se propague
  iniciar();
});

document.getElementById('stopBtn').addEventListener('click', function(event) {
  event.stopPropagation(); // Evitar que el evento se propague
  detener();
});

document.getElementById('resetBtn').addEventListener('click', function(event) {
  event.stopPropagation(); // Evitar que el evento se propague
  reiniciar();
});

// Estado inicial
actualizarDisplay();
actualizarFase();
// INICIAR habilitado porque el cron√≥metro no est√° corriendo
actualizarBotones(true, false, false, true);

console.log("üöÄ Cron√≥metro sincronizado listo");
console.log("üîä Toque la pantalla para activar el sonido");
</script>
</body>
</html>
